<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CLUB_2000_SECURE</title>
    <style>
        body { background: #008080; font-family: "Tahoma", sans-serif; margin: 0; padding: 10px; font-size: 13px; }
        .win { background: #c0c0c0; border: 2px solid; border-color: #fff #808080 #808080 #fff; width: 100%; max-width: 360px; margin: 0 auto; }
        .title { background: linear-gradient(to right, #000080, #1084d0); color: #fff; padding: 3px 5px; font-weight: bold; display: flex; justify-content: space-between; }
        #box { background: #fff; height: 250px; overflow-y: scroll; border: 2px inset #fff; margin: 5px; padding: 5px; }
        .msg { border-bottom: 1px dotted #808080; margin-bottom: 5px; padding-bottom: 2px; }
        .time { color: #666; font-size: 10px; }
        .u { color: #0000ff; font-weight: bold; cursor: pointer; text-decoration: underline; }
        .sys { color: #ff00ff; font-style: italic; }
        .input-bar { background: #c0c0c0; padding: 8px; border-top: 1px solid #808080; text-align: center; }
        input, textarea { font-size: 12px; border: 2px inset #fff; padding: 2px; }
        .btn { background: #c0c0c0; border: 2px solid; border-color: #fff #808080 #808080 #fff; cursor: pointer; padding: 2px 8px; font-weight: bold; font-size: 11px; }
        .btn:active { border-color: #808080 #fff #fff #808080; }
        #profile-win { position: fixed; top: 10%; left: 5%; right: 5%; display: none; z-index: 100; box-shadow: 8px 8px 0px rgba(0,0,0,0.5); }
        marquee { background: #000; color: #0f0; padding: 2px; font-family: monospace; }
    </style>
</head>
<body>

<div class="win">
    <div class="title"><span>üåº CLUB_2000_v3.exe</span> <span onclick="location.reload()">[?] [X]</span></div>
    <marquee scrollamount="3">–î–û–ë–†–û –ü–û–ñ–ê–õ–û–í–ê–¢–¨! –°–°–´–õ–ö–ò –†–ê–ó–†–ï–®–ï–ù–´ –¢–û–õ–¨–ö–û –ü–û–°–õ–ï –ó–ê–ü–û–õ–ù–ï–ù–ò–Ø –ê–ù–ö–ï–¢–´! –ü–†–ò–Ø–¢–ù–û–ì–û –û–ë–©–ï–ù–ò–Ø!</marquee>

    <div id="box">–ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π...</div>
    
    <div class="input-bar">
        <input type="text" id="user" value="User" style="width:50px">
        <input type="text" id="msg" style="width:160px" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ...">
        <button class="btn" onclick="send()">OK</button>
        <div style="margin-top:10px;">
            <button class="btn" onclick="load()">–û–ë–ù–û–í–ò–¢–¨</button>
            <button class="btn" onclick="document.getElementById('profile-win').style.display='block'">–ú–û–Ø –ê–ù–ö–ï–¢–ê</button>
        </div>
    </div>
</div>

<div id="profile-win" class="win">
    <div class="title">–†–ï–î–ê–ö–¢–û–† –ü–†–û–§–ò–õ–Ø</div>
    <div style="padding:10px;">
        –†–∞—Å—Å–∫–∞–∂–∏ –æ —Å–µ–±–µ (–¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –±–æ—Ç–æ–≤):<br>
        <textarea id="p-about" style="width:95%; height:40px;"></textarea><br>
        –¢–≤–æ—ë –ª—é–±–∏–º–æ–µ –∑–∞–Ω—è—Ç–∏–µ:<br>
        <input type="text" id="p-hobby" style="width:95%"><br><br>
        <button class="btn" onclick="saveProfile()">–°–û–•–†–ê–ù–ò–¢–¨</button>
        <button class="btn" onclick="document.getElementById('profile-win').style.display='none'">–ó–ê–ö–†–´–¢–¨</button>
    </div>
</div>

<script>
    var dbUrl = "https://ple7-edit-v1-default-rtdb.europe-west1.firebasedatabase.app/";

    // 1. –ó–ê–ì–†–£–ó–ö–ê
    function load() {
        var xhr = new XMLHttpRequest();
        xhr.open("GET", dbUrl + "messages.json?nocache=" + Math.random(), true);
        xhr.onreadystatechange = function() {
            if (xhr.readyState == 4 && xhr.status == 200) {
                var data = JSON.parse(xhr.responseText);
                var box = document.getElementById('box');
                box.innerHTML = "";
                for (var id in data) {
                    var m = data[id];
                    var t = m.t ? '<span class="time">[' + m.t + ']</span> ' : "";
                    var del = ' <span style="color:red;cursor:pointer" onclick="delMsg(\''+id+'\')">[x]</span>';
                    
                    if(m.u === "–°–ò–°–¢–ï–ú–ê") {
                        box.innerHTML += '<div class="msg">' + t + '<span class="sys">' + m.m + '</span>' + del + '</div>';
                    } else {
                        box.innerHTML += '<div class="msg">' + t + '<span class="u" onclick="viewUser(\''+m.u+'\')">' + m.u + ':</span> ' + m.m + del + '</div>';
                    }
                }
                box.scrollTop = box.scrollHeight;
            }
        };
        xhr.send();
    }

    // 2. –£–ú–ù–ê–Ø –û–¢–ü–†–ê–í–ö–ê –° –ü–†–û–í–ï–†–ö–û–ô –ù–ê –°–°–´–õ–ö–ò
    function send() {
        var u = document.getElementById('user').value;
        var m = document.getElementById('msg').value;
        if (!m) return;

        // –ò—â–µ–º –ø—Ä–∏–∑–Ω–∞–∫–∏ —Å—Å—ã–ª–æ–∫
        var linkPattern = /(http|https|www|\.ru|\.com|\.net|\.org)/i;
        if (linkPattern.test(m)) {
            // –ï—Å–ª–∏ —Å—Å—ã–ª–∫–∞ –µ—Å—Ç—å ‚Äî –ø—Ä–æ–≤–µ—Ä—è–µ–º –∞–Ω–∫–µ—Ç—É
            var checkXhr = new XMLHttpRequest();
            checkXhr.open("GET", dbUrl + "profiles/" + u + ".json", true);
            checkXhr.onreadystatechange = function() {
                if (checkXhr.readyState == 4) {
                    var profile = JSON.parse(checkXhr.responseText);
                    if (!profile) {
                        alert("‚ö†Ô∏è –°–¢–û–ü! –°—Å—ã–ª–∫–∏ –º–æ–≥—É—Ç —Å–ª–∞—Ç—å —Ç–æ–ª—å–∫–æ —Ç–µ, –∫—Ç–æ –∑–∞–ø–æ–ª–Ω–∏–ª –ê–ù–ö–ï–¢–£!");
                    } else {
                        proceedSend(u, m);
                    }
                }
            };
            checkXhr.send();
        } else {
            // –°—Å—ã–ª–æ–∫ –Ω–µ—Ç ‚Äî —à–ª–µ–º —Å—Ä–∞–∑—É
            proceedSend(u, m);
        }
    }

    function proceedSend(u, m) {
        if (m.indexOf('/me ') === 0) {
            m = "*** " + u + " " + m.substring(4) + " ***";
            u = "–°–ò–°–¢–ï–ú–ê";
        } else if (m.indexOf('/love ') === 0) {
           m = "<b style='color:red;'>&lt;3 &lt;3 " + u + " –ø–æ—Å—ã–ª–∞–µ—Ç –ª—é–±–æ–≤—å –¥–ª—è " + m.substring(6) + "! &lt;3 &lt;3</b>";
        }

        var d = new Date();
        var time = (d.getHours()<10?'0':'')+d.getHours()+":"+(d.getMinutes()<10?'0':'')+d.getMinutes();

        var xhr = new XMLHttpRequest();
        xhr.open("POST", dbUrl + "messages.json", true);
        xhr.onreadystatechange = function() { if(xhr.readyState==4) { document.getElementById('msg').value=""; load(); } };
        xhr.send(JSON.stringify({ u: u, m: m, t: time }));
    }

    // 3. –ê–ù–ö–ï–¢–´
    function saveProfile() {
        var u = document.getElementById('user').value;
        var a = document.getElementById('p-about').value;
        var h = document.getElementById('p-hobby').value;
        if (u === "User") { alert("–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏ —Å–µ–±–µ –∫—Ä—É—Ç–æ–π –Ω–∏–∫!"); return; }
        
        var xhr = new XMLHttpRequest();
        xhr.open("PUT", dbUrl + "profiles/" + u + ".json", true);
        xhr.send(JSON.stringify({ about: a, hobby: h }));
        alert("–ê–Ω–∫–µ—Ç–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞! –¢–µ–ø–µ—Ä—å —Ç—ã —ç–ª–∏—Ç–Ω—ã–π —É—á–∞—Å—Ç–Ω–∏–∫ –∫–ª—É–±–∞.");
        document.getElementById('profile-win').style.display = 'none';
    }

    function viewUser(name) {
        var xhr = new XMLHttpRequest();
        xhr.open("GET", dbUrl + "profiles/" + name + ".json", true);
        xhr.onreadystatechange = function() {
            if (xhr.readyState == 4 && xhr.status == 200) {
                var p = JSON.parse(xhr.responseText);
                if (!p) alert("–£ —é–∑–µ—Ä–∞ " + name + " –µ—â–µ –Ω–µ—Ç –∞–Ω–∫–µ—Ç—ã.");
                else alert("–ê–ù–ö–ï–¢–ê –Æ–ó–ï–†–ê " + name + ":\n\n–û —Å–µ–±–µ: " + p.about + "\n–•–æ–±–±–∏: " + p.hobby);
            }
        };
        xhr.send();
    }

    // 4. –£–î–ê–õ–ï–ù–ò–ï (–ü–∞—Ä–æ–ª—å 2000)
    function delMsg(id) {
        var p = prompt("–ü–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∞:");
        if (p === "2000") {
            var xhr = new XMLHttpRequest();
            xhr.open("DELETE", dbUrl + "messages/" + id + ".json", true);
            xhr.onreadystatechange = function() { if(xhr.readyState==4) load(); };
            xhr.send();
        }
    }

    load();
    setInterval(load, 30000); // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
</script>
</body>
</html>
