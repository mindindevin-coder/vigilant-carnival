<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>XP_CHAT_CLUB_2000</title>
    <style>
        /* –†–µ—Ç—Ä–æ-—Å—Ç–∏–ª—å Windows XP / Aero */
        body { background: #008080; font-family: "Tahoma", "Arial", sans-serif; margin: 0; padding: 10px; font-size: 13px; }
        .win { background: #c0c0c0; border: 2px solid; border-color: #fff #808080 #808080 #fff; width: 100%; max-width: 350px; margin: 0 auto; }
        .title { background: linear-gradient(to right, #000080, #1084d0); color: #fff; padding: 3px 5px; font-weight: bold; display: flex; justify-content: space-between; align-items: center; }
        
        /* –ó–æ–Ω–∞ —á–∞—Ç–∞ */
        #box { background: #fff; height: 220px; overflow-y: scroll; border: 2px inset #fff; margin: 5px; padding: 5px; }
        .msg { border-bottom: 1px dotted #808080; margin-bottom: 5px; padding-bottom: 3px; word-wrap: break-word; }
        .time { color: #666; font-size: 10px; font-family: monospace; }
        .u { color: #0000ff; font-weight: bold; cursor: pointer; text-decoration: underline; }
        .sys { color: #ff00ff; font-style: italic; }
        
        /* –ü–æ–ª—è –≤–≤–æ–¥–∞ */
        .input-bar { background: #c0c0c0; padding: 8px; border-top: 1px solid #808080; }
        input { font-size: 12px; padding: 2px; border: 2px inset #fff; }
        .btn { background: #c0c0c0; border: 2px solid; border-color: #fff #808080 #808080 #fff; cursor: pointer; padding: 2px 6px; font-size: 11px; font-weight: bold; }
        .btn:active { border-color: #808080 #fff #fff #808080; }

        /* –û–∫–Ω–æ –∞–Ω–∫–µ—Ç—ã */
        #profile-win { 
            position: fixed; top: 15%; left: 5%; right: 5%; display: none; z-index: 100;
            box-shadow: 10px 10px 0px rgba(0,0,0,0.3);
        }
        marquee { background: #000; color: #0f0; font-family: monospace; padding: 2px; }
    </style>
</head>
<body>

<div class="win">
    <div class="title">
        <span>üåº CLUB_2000.exe</span>
        <span onclick="location.reload()" style="cursor:pointer">[?] [X]</span>
    </div>
    
    <marquee scrollamount="3">*** –î–û–ë–†–û –ü–û–ñ–ê–õ–û–í–ê–¢–¨ –í –ö–õ–£–ë –Æ–ó–ï–†–û–í 2000-—Ö! *** –ü–ò–®–ò /me –î–õ–Ø –î–ï–ô–°–¢–í–ò–ô *** /love –î–õ–Ø –õ–Æ–ë–í–ò ***</marquee>

    <div id="box">–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–≤—è–∑–∏...</div>
    
    <div class="input-bar">
        <table width="100%">
            <tr>
                <td><input type="text" id="user" value="User" style="width:50px" title="–ù–∏–∫"></td>
                <td><input type="text" id="msg" style="width:95%" placeholder="–¢–µ–∫—Å—Ç..."></td>
                <td><button class="btn" onclick="send()">OK</button></td>
            </tr>
        </table>
        <div style="margin-top:8px; text-align: center;">
            <button class="btn" onclick="load()">–û–ë–ù–û–í–ò–¢–¨ [F5]</button>
            <button class="btn" onclick="openProfile()">–ê–ù–ö–ï–¢–ê</button>
        </div>
    </div>
</div>

<div id="profile-win" class="win">
    <div class="title">–†–ï–î–ê–ö–¢–û–† –ê–ù–ö–ï–¢–´</div>
    <div style="padding:10px;">
        –û —Å–µ–±–µ:<br>
        <textarea id="p-about" style="width:95%; height:50px;"></textarea><br>
        –•–æ–±–±–∏:<br>
        <input type="text" id="p-hobby" style="width:95%"><br><br>
        <button class="btn" onclick="saveProfile()">–°–û–•–†–ê–ù–ò–¢–¨</button>
        <button class="btn" onclick="document.getElementById('profile-win').style.display='none'">–û–¢–ú–ï–ù–ê</button>
    </div>
</div>

<script>
    // –¢–í–û–ò –ù–ê–°–¢–†–û–ô–ö–ò
    var dbUrl = "https://ple7-edit-v1-default-rtdb.europe-west1.firebasedatabase.app/";

    // 1. –ó–ê–ì–†–£–ó–ö–ê –°–û–û–ë–©–ï–ù–ò–ô
    function load() {
        var xhr = new XMLHttpRequest();
        xhr.open("GET", dbUrl + "messages.json?nocache=" + Math.random(), true);
        xhr.onreadystatechange = function() {
            if (xhr.readyState == 4 && xhr.status == 200) {
                var data = JSON.parse(xhr.responseText);
                var box = document.getElementById('box');
                box.innerHTML = "";
                for (var id in data) {
                    var m = data[id];
                    var t = m.t ? '<span class="time">[' + m.t + ']</span> ' : "";
                    var del = ' <span style="color:red;cursor:pointer" onclick="delMsg(\''+id+'\')">[x]</span>';
                    
                    // –ï—Å–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–Ω–æ–µ (–∫–æ–º–∞–Ω–¥—ã)
                    if(m.u === "–°–ò–°–¢–ï–ú–ê") {
                        box.innerHTML += '<div class="msg">' + t + '<span class="sys">' + m.m + '</span>' + del + '</div>';
                    } else {
                        box.innerHTML += '<div class="msg">' + t + '<span class="u" onclick="viewUser(\''+m.u+'\')">' + m.u + ':</span> ' + m.m + del + '</div>';
                    }
                }
                box.scrollTop = box.scrollHeight;
            }
        };
        xhr.send();
    }

    // 2. –û–¢–ü–†–ê–í–ö–ê
    function send() {
        var u = document.getElementById('user').value;
        var m = document.getElementById('msg').value;
        if (!m) return;

        // –ö–æ–º–∞–Ω–¥—ã
        if (m.indexOf('/me ') === 0) {
            m = "*** " + u + " " + m.substring(4) + " ***";
            u = "–°–ò–°–¢–ï–ú–ê";
        } else if (m.indexOf('/love ') === 0) {
            m = "‚ù§‚ù§ " + u + " —à–ª–µ—Ç –ª—é–±–æ–≤—å –¥–ª—è " + m.substring(6) + "! ‚ù§‚ù§";
            u = "–°–ò–°–¢–ï–ú–ê";
        }

        var d = new Date();
        var time = (d.getHours()<10?'0':'')+d.getHours()+":"+(d.getMinutes()<10?'0':'')+d.getMinutes();

        var xhr = new XMLHttpRequest();
        xhr.open("POST", dbUrl + "messages.json", true);
        xhr.setRequestHeader("Content-Type", "application/json");
        xhr.onreadystatechange = function() { if(xhr.readyState==4) { document.getElementById('msg').value=""; load(); } };
        xhr.send(JSON.stringify({ u: u, m: m, t: time }));
    }

    // 3. –ê–ù–ö–ï–¢–´
    function viewUser(name) {
        var xhr = new XMLHttpRequest();
        xhr.open("GET", dbUrl + "profiles/" + name + ".json", true);
        xhr.onreadystatechange = function() {
            if (xhr.readyState == 4 && xhr.status == 200) {
                var p = JSON.parse(xhr.responseText);
                if (!p) alert("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å " + name + " –µ—â–µ –Ω–µ –∑–∞–ø–æ–ª–Ω–∏–ª –∞–Ω–∫–µ—Ç—É.");
                else alert("–ê–ù–ö–ï–¢–ê: " + name + "\n–û —Å–µ–±–µ: " + p.about + "\n–•–æ–±–±–∏: " + p.hobby);
            }
        };
        xhr.send();
    }

    function openProfile() { document.getElementById('profile-win').style.display = 'block'; }

    function saveProfile() {
        var u = document.getElementById('user').value;
        var a = document.getElementById('p-about').value;
        var h = document.getElementById('p-hobby').value;
        var xhr = new XMLHttpRequest();
        xhr.open("PUT", dbUrl + "profiles/" + u + ".json", true);
        xhr.send(JSON.stringify({ about: a, hobby: h }));
        alert("–ê–Ω–∫–µ—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞!");
        document.getElementById('profile-win').style.display = 'none';
    }

    // 4. –£–î–ê–õ–ï–ù–ò–ï (–ê–î–ú–ò–ù)
    function delMsg(id) {
        var p = prompt("–ü–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∞:");
        if (p === "2000") {
            var xhr = new XMLHttpRequest();
            xhr.open("DELETE", dbUrl + "messages/" + id + ".json", true);
            xhr.onreadystatechange = function() { if(xhr.readyState==4) load(); };
            xhr.send();
        } else if (p !== null) { alert("–í –¥–æ—Å—Ç—É–ø–µ –æ—Ç–∫–∞–∑–∞–Ω–æ!"); }
    }

    // –°—Ç–∞—Ä—Ç
    load();
    // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–∞–∑ –≤ 30 —Å–µ–∫ (–¥–ª—è –º–∞–º–∏–Ω–æ–≥–æ Ergo)
    setInterval(load, 30000);
</script>

</body>
</html>
