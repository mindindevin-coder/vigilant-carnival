<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>CLUB 2000 - –ê–Ω–∫–µ—Ç—ã</title>
    <style>
        body { background: #008080; font-family: "Tahoma", sans-serif; font-size: 13px; }
        .win { background: #c0c0c0; border: 2px solid; border-color: #fff #808080 #808080 #fff; width: 320px; margin: 10px auto; padding: 2px; }
        .title { background: #000080; color: #fff; padding: 3px; font-weight: bold; display: flex; justify-content: space-between; }
        #box { background: #fff; height: 180px; overflow: auto; border: 2px inset #fff; margin: 5px; padding: 3px; }
        
        /* –ê–Ω–∫–µ—Ç–∞ (—Å–∫—Ä—ã—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) */
        #profile-win { 
            position: fixed; top: 20%; left: 5%; right: 5%; 
            background: #c0c0c0; border: 2px solid #fff; display: none; z-index: 10;
            box-shadow: 5px 5px 0px #000;
        }

        .u { color: #0000ff; font-weight: bold; cursor: pointer; text-decoration: underline; }
        .msg { border-bottom: 1px dotted #808080; margin-bottom: 4px; }
        .btn { background: #c0c0c0; border: 2px solid; border-color: #fff #808080 #808080 #fff; cursor: pointer; font-size: 11px; }
        .btn:active { border-color: #808080 #fff #fff #808080; }
    </style>
</head>
<body>

<div class="win">
    <div class="title"><span>üåº CLUB_2000.exe</span> <span onclick="location.reload()" style="cursor:pointer">[X]</span></div>
    
    <div style="text-align:center; padding: 5px;">
        <marquee scrollamount="3" style="background:#000; color:#0f0; border:1px solid #fff;">–î–û–ë–†–û –ü–û–ñ–ê–õ–û–í–ê–¢–¨ –í –ö–õ–£–ë –î–õ–Ø –¢–ï–• –ö–¢–û –í –¢–ê–ù–ö–ï!</marquee>
    </div>

    <div id="box">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    
    <div style="padding:5px;">
        <input type="text" id="user" value="User" style="width:40px">
        <input type="text" id="msg" style="width:180px" placeholder="–ù–∞–ø–∏—à–∏ —á—Ç–æ-–Ω–∏—Ç—å...">
        <button class="btn" onclick="send()">–û–¢–ü–†–ê–í–ò–¢–¨</button>
        <br><br>
        <button class="btn" onclick="load()">–û–ë–ù–û–í–ò–¢–¨</button>
        <button class="btn" onclick="openMyProfile()">–ú–û–Ø –ê–ù–ö–ï–¢–ê</button>
    </div>
</div>

<div id="profile-win" class="win">
    <div class="title">–ê–ù–ö–ï–¢–ê –Æ–ó–ï–†–ê</div>
    <div style="padding:10px;" id="profile-content">
        –ò–º—è: <input type="text" id="p-name" style="width:100%"><br>
        –û —Å–µ–±–µ: <textarea id="p-about" style="width:100%"></textarea><br>
        –•–æ–±–±–∏: <input type="text" id="p-hobby" style="width:100%"><br><br>
        <button class="btn" onclick="saveProfile()">–°–û–•–†–ê–ù–ò–¢–¨</button>
        <button class="btn" onclick="document.getElementById('profile-win').style.display='none'">–ó–ê–ö–†–´–¢–¨</button>
    </div>
</div>

<script>
    var dbUrl = "https://ple7-edit-v1-default-rtdb.europe-west1.firebasedatabase.app/";

    // –ü–æ–∫–∞–∑–∞—Ç—å —á—É–∂—É—é –∞–Ω–∫–µ—Ç—É
    function showUser(name) {
        var xhr = new XMLHttpRequest();
        xhr.open("GET", dbUrl + "profiles/" + name + ".json", true);
        xhr.onreadystatechange = function() {
            if (xhr.readyState == 4 && xhr.status == 200) {
                var p = JSON.parse(xhr.responseText);
                if (!p) { alert("–Æ–∑–µ—Ä –µ—â–µ –Ω–µ –∑–∞–ø–æ–ª–Ω–∏–ª –∞–Ω–∫–µ—Ç—É!"); return; }
                alert("–ê–ù–ö–ï–¢–ê " + name + "\n---\n–û —Å–µ–±–µ: " + p.about + "\n–•–æ–±–±–∏: " + p.hobby);
            }
        };
        xhr.send();
    }

    function openMyProfile() {
        document.getElementById('profile-win').style.display = 'block';
    }

    function saveProfile() {
        var name = document.getElementById('user').value;
        var about = document.getElementById('p-about').value;
        var hobby = document.getElementById('p-hobby').value;
        
        var xhr = new XMLHttpRequest();
        xhr.open("PUT", dbUrl + "profiles/" + name + ".json", true);
        xhr.send(JSON.stringify({ about: about, hobby: hobby }));
        alert("–ê–Ω–∫–µ—Ç–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!");
        document.getElementById('profile-win').style.display = 'none';
    }

    function load() {
        var xhr = new XMLHttpRequest();
        xhr.open("GET", dbUrl + "messages.json?nocache=" + Math.random(), true);
        xhr.onreadystatechange = function() {
            if (xhr.readyState == 4 && xhr.status == 200) {
                var data = JSON.parse(xhr.responseText);
                var html = "";
                for (var id in data) {
                    var m = data[id];
                    html += '<div class="msg">[' + (m.t||"") + '] <span class="u" onclick="showUser(\''+m.u+'\')">' + m.u + ':</span> ' + m.m + '</div>';
                }
                document.getElementById('box').innerHTML = html;
            }
        };
        xhr.send();
    }

    function send() {
        var u = document.getElementById('user').value;
        var m = document.getElementById('msg').value;
        if (!m) return;
        var h = new Date().getHours(); var min = new Date().getMinutes();
        var timeStr = (h<10?"0"+h:h) + ":" + (min<10?"0"+min:min);

        var xhr = new XMLHttpRequest();
        xhr.open("POST", dbUrl + "messages.json", true);
        xhr.send(JSON.stringify({ u: u, m: m, t: timeStr }));
        document.getElementById('msg').value = "";
        setTimeout(load, 500);
    }

    load();
</script>
</body>
</html>
